
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Space2Stats</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'README';</script>
    <link rel="canonical" href="https://github.com/worldbank/DECAT_Space2Stats/README.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Project Description" href="docs/Introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="#">

  
  
  
  
  
  
  

  
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="_static/logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docs/Introduction.html">
                        Project Description
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_Comparing_H3_WBAdmin.html">
                        Comparing H3 cells to administrative boundaries
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_RunZonal.html">
                        S2S Kenya - Zonal statistics
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_RunZonal_HTI.html">
                        S2S Haiti - Zonal statistics
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/h3-food-security.html">
                        H3 Grid and Food Security
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docs/annexA.html">
                        Annex A: Datasets to be Summarized
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docs/Introduction.html">
                        Project Description
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_Comparing_H3_WBAdmin.html">
                        Comparing H3 cells to administrative boundaries
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_RunZonal.html">
                        S2S Kenya - Zonal statistics
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/Space2Stats_RunZonal_HTI.html">
                        S2S Haiti - Zonal statistics
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="notebooks/h3-food-security.html">
                        H3 Grid and Food Security
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docs/annexA.html">
                        Annex A: Datasets to be Summarized
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="#">

  
  
  
  
  
  
  

  
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="_static/logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Space2Stats
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Concept Note</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="docs/Introduction.html">Project Description</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Example summaries</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="notebooks/Space2Stats_Comparing_H3_WBAdmin.html">Comparing H3 cells to administrative boundaries</a></li>

<li class="toctree-l1"><a class="reference internal" href="notebooks/Space2Stats_RunZonal.html">S2S Kenya - Zonal statistics</a></li>



<li class="toctree-l1"><a class="reference internal" href="notebooks/Space2Stats_RunZonal_HTI.html">S2S Haiti - Zonal statistics</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Food Security</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="notebooks/h3-food-security.html">H3 Grid and Food Security</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="docs/annexA.html">Annex A: Datasets to be Summarized</a></li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/worldbank/DECAT_Space2Stats" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/worldbank/DECAT_Space2Stats/issues/new?title=Issue%20on%20page%20%2FREADME.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
      <li><a href="https://github.com/worldbank/DECAT_Space2Stats/edit/main/README.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">suggest edit</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="_sources/README.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Space2Stats</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started-locally">
   Getting Started Locally
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation">
     Installation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#module">
     Module
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statstable-summaries">
       <code class="docutils literal notranslate">
        <span class="pre">
         StatsTable.summaries()
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description">
         Description
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#parameters">
         Parameters
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#returns">
         Returns
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#example">
         Example
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fields-method">
       <code class="docutils literal notranslate">
        <span class="pre">
         fields
        </span>
       </code>
       Method
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id1">
         Description
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id2">
         Returns
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id3">
         Example
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <section class="tex2jax_ignore mathjax_ignore" id="space2stats">
<h1>Space2Stats<a class="headerlink" href="#space2stats" title="Permalink to this heading">#</a></h1>
<p>Consistent, comparable, authoritative data describing sub-national variation is a constant point of complication for World Bank teams, our development partners, and client countries when assessing and investigating economic issues and national policy. This project will focus on creating and disseminating such data through aggregation of geospatial information at standard administrative divisions, and through the attribution of household survey data with foundational geospatial variables.</p>
<section id="getting-started-locally">
<h2>Getting Started Locally<a class="headerlink" href="#getting-started-locally" title="Permalink to this heading">#</a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">#</a></h3>
<p>The module can be installed via <code class="docutils literal notranslate"><span class="pre">pip</span></code> directly from Github:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="s2">&quot;git+https://github.com/worldbank/DECAT_Space2Stats.git#subdirectory=space2stats_api/src&quot;</span>
</pre></div>
</div>
</section>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h3>
<ul>
<li><p>Setup the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">db.env</span></code> file:</p>
<div class="highlight-.env notranslate"><div class="highlight"><pre><span></span>PGHOST=localhost
PGPORT=5439
PGDATABASE=postgis
PGUSER=username
PGPASSWORD=password
PGTABLENAME=space2stats
</pre></div>
</div>
</li>
<li><p>Ingest the dataset into the database:</p>
<p>Use the space2stats-ingest CLI to download the Parquet file from S3 and load it into your database. You’ll also need the STAC metadata file to validate the Parquet schema during ingestion.</p>
<p>To download the Parquet file from S3 and load it into the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">run</span> <span class="n">space2stats</span><span class="o">-</span><span class="n">ingest</span> <span class="n">download</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">load</span> \
<span class="s2">&quot;s3://&lt;bucket&gt;/space2stats.parquet&quot;</span> \
<span class="s2">&quot;postgresql://username:password@localhost:5439/postgis&quot;</span> \
<span class="s2">&quot;&lt;path&gt;/space2stats.json&quot;</span> \
<span class="o">--</span><span class="n">parquet</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;local.parquet&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>Alternatively, you can download the Parquet file and load it into the database separately:</p>
<ul>
<li><p>Download the Parquet file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">run</span> <span class="n">space2stats</span><span class="o">-</span><span class="n">ingest</span> <span class="n">download</span> \
    <span class="s2">&quot;s3://&lt;bucket&gt;/space2stats.parquet&quot;</span> \
    <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;local.parquet&quot;</span>
</pre></div>
</div>
</li>
<li><p>Load the Parquet file into the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poetry</span> <span class="n">run</span> <span class="n">space2stats</span><span class="o">-</span><span class="n">ingest</span> <span class="n">load</span> \
<span class="s2">&quot;postgresql://username:password@localhost:5439/postgis&quot;</span> \
<span class="s2">&quot;&lt;path&gt;/space2stats.json&quot;</span> \
<span class="o">--</span><span class="n">parquet</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;local.parquet&quot;</span>
</pre></div>
</div>
</li>
<li><p>Finally, access your data using the Space2stats API! See the <span class="xref myst">example notebook</span>.</p></li>
</ul>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">#</a></h2>
<section id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this heading">#</a></h3>
<p>The API server can be run locally with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">space2stats</span>
</pre></div>
</div>
<p>Once running, interactive API documentation can be found at the <code class="docutils literal notranslate"><span class="pre">/docs</span></code> endpoint (e.g. <a class="reference external" href="http://localhost:8000/docs">http://localhost:8000/docs</a>).</p>
<p>API server properties can be customized via the following environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UVICORN_HOST</span></code>: Server host. <em>Default: <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code></em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UVICORN_PORT</span></code>: Server port. <em>Default: <code class="docutils literal notranslate"><span class="pre">8000</span></code></em></p></li>
</ul>
</section>
<section id="module">
<h3>Module<a class="headerlink" href="#module" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">space2stats</span></code> module surfaces the <code class="docutils literal notranslate"><span class="pre">StatsTable</span></code> class to enable direct DB queries (ie without using the API server).</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">space2stats</span> <span class="kn">import</span> <span class="n">StatsTable</span>

<span class="k">with</span> <span class="n">StatsTable</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">stats_table</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Connection parameters may be explicitely provided. Otherwise, connection parameters will expected to be available via standard <a class="reference external" href="https://www.postgresql.org/docs/current/libpq-envars.html#LIBPQ-ENVARS">PostgreSQL Environment Variables</a>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">space2stats</span> <span class="kn">import</span> <span class="n">StatsTable</span>

<span class="k">with</span> <span class="n">StatsTable</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">PGHOST</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="n">PGPORT</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
    <span class="n">PGUSER</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
    <span class="n">PGPASSWORD</span><span class="o">=</span><span class="s2">&quot;changeme&quot;</span><span class="p">,</span>
    <span class="n">PGDATABASE</span><span class="o">=</span><span class="s2">&quot;postgis&quot;</span><span class="p">,</span>
    <span class="n">PGTABLENAME</span><span class="o">=</span><span class="s2">&quot;space2stats&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">stats_table</span><span class="p">:</span>
    <span class="o">...</span>

<span class="c1"># alternatively:</span>
<span class="c1"># settings = Settings(</span>
<span class="c1">#     PGHOST=&quot;localhost&quot;,</span>
<span class="c1">#     PGPORT=&quot;5432&quot;,</span>
<span class="c1">#     PGUSER=&quot;postgres&quot;,</span>
<span class="c1">#     PGPASSWORD=&quot;changeme&quot;,</span>
<span class="c1">#     PGDATABASE=&quot;postgis&quot;,</span>
<span class="c1">#     PGTABLENAME=&quot;space2stats&quot;,</span>
<span class="c1"># )</span>
<span class="c1"># with StatsTable.connect(settings):</span>
<span class="c1">#     ...</span>
</pre></div>
</div>
<section id="statstable-summaries">
<h4><code class="docutils literal notranslate"><span class="pre">StatsTable.summaries()</span></code><a class="headerlink" href="#statstable-summaries" title="Permalink to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">StatsTable</span><span class="o">.</span><span class="n">summaries</span><span class="p">(</span>
    <span class="n">aoi</span><span class="p">:</span> <span class="n">AoiModel</span><span class="p">,</span>
    <span class="n">spatial_join_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;touches&quot;</span><span class="p">,</span> <span class="s2">&quot;centroid&quot;</span><span class="p">,</span> <span class="s2">&quot;within&quot;</span><span class="p">],</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">geometry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;polygon&quot;</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>
</pre></div>
</div>
<section id="description">
<h5>Description<a class="headerlink" href="#description" title="Permalink to this heading">#</a></h5>
<p>Retrieves statistical summaries for the specified Area of Interest (AOI) from a PostgreSQL table.</p>
<p>This method is used to obtain aggregated statistics from hexagonal H3 cells that intersect with the AOI’s geometry, using a chosen spatial join method.</p>
</section>
<section id="parameters">
<h5>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p><strong>aoi</strong> (<code class="docutils literal notranslate"><span class="pre">AoiModel</span></code>): The Area of Interest, either as a <code class="docutils literal notranslate"><span class="pre">Feature</span></code> or an instance of <code class="docutils literal notranslate"><span class="pre">AoiModel</span></code>.</p></li>
<li><p><strong>spatial_join_method</strong> (<code class="docutils literal notranslate"><span class="pre">Literal[&quot;touches&quot;,</span> <span class="pre">&quot;centroid&quot;,</span> <span class="pre">&quot;within&quot;]</span></code>): The method to use for performing the spatial join between the AOI and H3 cells.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;touches&quot;</span></code>: Includes H3 cells that touch the AOI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;centroid&quot;</span></code>: Includes H3 cells where the centroid falls within the AOI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;within&quot;</span></code>: Includes H3 cells entirely within the AOI.</p></li>
</ul>
</li>
<li><p><strong>fields</strong> (<code class="docutils literal notranslate"><span class="pre">List[str]</span></code>): A list of field names to retrieve from the statistics table.</p></li>
<li><p><strong>geometry</strong> (<code class="docutils literal notranslate"><span class="pre">Optional[Literal[&quot;polygon&quot;,</span> <span class="pre">&quot;point&quot;]]</span></code>): Specifies if the H3 geometries should be included in the response. It can be either <code class="docutils literal notranslate"><span class="pre">&quot;polygon&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;point&quot;</span></code>. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, geometries are not included.</p></li>
</ul>
</section>
<section id="returns">
<h5>Returns<a class="headerlink" href="#returns" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">List[Dict]</span></code></strong>: A list of dictionaries containing statistical summaries for each H3 cell. Each dictionary contains:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;hex_id&quot;</span></code>: The H3 cell identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;geometry&quot;</span></code> (optional): The geometry of the H3 cell, if <code class="docutils literal notranslate"><span class="pre">geometry</span></code> is specified.</p></li>
<li><p>Other fields from the statistics table, based on the specified <code class="docutils literal notranslate"><span class="pre">fields</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span> <span class="o">=</span> <span class="n">AoiModel</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=...</span><span class="p">)</span>
<span class="k">with</span> <span class="n">StatsTable</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">stats_table</span><span class="p">:</span>
    <span class="n">summaries</span> <span class="o">=</span> <span class="n">stats_table</span><span class="o">.</span><span class="n">summaries</span><span class="p">(</span>
        <span class="n">aoi</span><span class="o">=</span><span class="n">aoi</span><span class="p">,</span>
        <span class="n">spatial_join_method</span><span class="o">=</span><span class="s2">&quot;centroid&quot;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="s2">&quot;average_income&quot;</span><span class="p">],</span>
        <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="fields-method">
<h4><code class="docutils literal notranslate"><span class="pre">fields</span></code> Method<a class="headerlink" href="#fields-method" title="Permalink to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">StatsTable</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</pre></div>
</div>
<section id="id1">
<h5>Description<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h5>
<p>Retrieves the list of column names from the PostgreSQL statistics table, excluding the <code class="docutils literal notranslate"><span class="pre">&quot;hex_id&quot;</span></code> column.</p>
<p>This method is helpful for understanding the available fields that can be queried for statistical summaries.</p>
</section>
<section id="id2">
<h5>Returns<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">List[str]</span></code></strong>: A list of column names from the statistics table, excluding <code class="docutils literal notranslate"><span class="pre">&quot;hex_id&quot;</span></code>.</p></li>
</ul>
</section>
<section id="id3">
<h5>Example<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">StatsTable</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">stats_table</span><span class="p">:</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">stats_table</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>  <span class="c1"># Output: [&#39;population&#39;, &#39;average_income&#39;, ...]</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='right-next' id="next-link" href="docs/Introduction.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Project Description</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started-locally">
   Getting Started Locally
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation">
     Installation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#module">
     Module
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statstable-summaries">
       <code class="docutils literal notranslate">
        <span class="pre">
         StatsTable.summaries()
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#description">
         Description
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#parameters">
         Parameters
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#returns">
         Returns
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#example">
         Example
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fields-method">
       <code class="docutils literal notranslate">
        <span class="pre">
         fields
        </span>
       </code>
       Method
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id1">
         Description
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id2">
         Returns
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id3">
         Example
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By World Bank
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on Oct 02, 2024.<br>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
    <b>All content (unless otherwise specified) is subject to the <a href="https://raw.githubusercontent.com/worldbank/template/main/LICENSE">World Bank Master Community License Agreement.</a></b>
</div>

</div>
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>