-- Space2Stats Development Database Initialization
DROP TABLE IF EXISTS space2stats CASCADE;

-- Create space2stats table with complete schema matching space2stats_sample_cs.parquet
CREATE TABLE IF NOT EXISTS space2stats (
    hex_id VARCHAR PRIMARY KEY,
    geometry VARCHAR,
    sum_built_area_m_2030 BIGINT,
    pop DOUBLE PRECISION,
    pop_flood DOUBLE PRECISION,
    pop_flood_pct DOUBLE PRECISION,
    sum_pop_f_0_2020 DOUBLE PRECISION,
    sum_pop_f_10_2020 DOUBLE PRECISION,
    sum_pop_f_15_2020 DOUBLE PRECISION,
    sum_pop_f_1_2020 DOUBLE PRECISION,
    sum_pop_f_20_2020 DOUBLE PRECISION,
    sum_pop_f_25_2020 DOUBLE PRECISION,
    sum_pop_f_30_2020 DOUBLE PRECISION,
    sum_pop_f_35_2020 DOUBLE PRECISION,
    sum_pop_f_40_2020 DOUBLE PRECISION,
    sum_pop_f_45_2020 DOUBLE PRECISION,
    sum_pop_f_50_2020 DOUBLE PRECISION,
    sum_pop_f_55_2020 DOUBLE PRECISION,
    sum_pop_f_5_2020 DOUBLE PRECISION,
    sum_pop_f_60_2020 DOUBLE PRECISION,
    sum_pop_f_65_2020 DOUBLE PRECISION,
    sum_pop_f_70_2020 DOUBLE PRECISION,
    sum_pop_f_75_2020 DOUBLE PRECISION,
    sum_pop_f_80_2020 DOUBLE PRECISION,
    sum_pop_m_0_2020 DOUBLE PRECISION,
    sum_pop_m_10_2020 DOUBLE PRECISION,
    sum_pop_m_15_2020 DOUBLE PRECISION,
    sum_pop_m_1_2020 DOUBLE PRECISION,
    sum_pop_m_20_2020 DOUBLE PRECISION,
    sum_pop_m_25_2020 DOUBLE PRECISION,
    sum_pop_m_30_2020 DOUBLE PRECISION,
    sum_pop_m_35_2020 DOUBLE PRECISION,
    sum_pop_m_40_2020 DOUBLE PRECISION,
    sum_pop_m_45_2020 DOUBLE PRECISION,
    sum_pop_m_50_2020 DOUBLE PRECISION,
    sum_pop_m_55_2020 DOUBLE PRECISION,
    sum_pop_m_5_2020 DOUBLE PRECISION,
    sum_pop_m_60_2020 DOUBLE PRECISION,
    sum_pop_m_65_2020 DOUBLE PRECISION,
    sum_pop_m_70_2020 DOUBLE PRECISION,
    sum_pop_m_75_2020 DOUBLE PRECISION,
    sum_pop_m_80_2020 DOUBLE PRECISION,
    sum_pop_f_2020 DOUBLE PRECISION,
    sum_pop_m_2020 DOUBLE PRECISION,
    sum_pop_2020 DOUBLE PRECISION,
    sum_pop_m_2020_v2 DOUBLE PRECISION,
    sum_pop_f_2020_v2 DOUBLE PRECISION,
    sum_pop_2020_v2 DOUBLE PRECISION,
    ghs_11_count BIGINT,
    ghs_12_count BIGINT,
    ghs_13_count BIGINT,
    ghs_21_count BIGINT,
    ghs_22_count BIGINT,
    ghs_23_count BIGINT,
    ghs_30_count BIGINT,
    ghs_total_count BIGINT,
    ghs_11_pop DOUBLE PRECISION,
    ghs_12_pop DOUBLE PRECISION,
    ghs_13_pop DOUBLE PRECISION,
    ghs_21_pop DOUBLE PRECISION,
    ghs_22_pop DOUBLE PRECISION,
    ghs_23_pop DOUBLE PRECISION,
    ghs_30_pop DOUBLE PRECISION,
    ghs_total_pop DOUBLE PRECISION,
    sum_viirs_ntl_201201 DOUBLE PRECISION,
    sum_viirs_ntl_201202 DOUBLE PRECISION,
    sum_viirs_ntl_201203 DOUBLE PRECISION,
    sum_viirs_ntl_201204 DOUBLE PRECISION,
    sum_viirs_ntl_201205 DOUBLE PRECISION,
    sum_viirs_ntl_201206 DOUBLE PRECISION,
    sum_viirs_ntl_201207 DOUBLE PRECISION,
    sum_viirs_ntl_201208 DOUBLE PRECISION,
    sum_viirs_ntl_201209 DOUBLE PRECISION,
    sum_viirs_ntl_201210 DOUBLE PRECISION,
    sum_viirs_ntl_201211 DOUBLE PRECISION,
    sum_viirs_ntl_201212 DOUBLE PRECISION,
    sum_viirs_ntl_201301 DOUBLE PRECISION,
    sum_viirs_ntl_201302 DOUBLE PRECISION,
    sum_viirs_ntl_201303 DOUBLE PRECISION,
    sum_viirs_ntl_201304 DOUBLE PRECISION,
    sum_viirs_ntl_201305 DOUBLE PRECISION,
    sum_viirs_ntl_201306 DOUBLE PRECISION,
    sum_viirs_ntl_201307 DOUBLE PRECISION,
    sum_viirs_ntl_201308 DOUBLE PRECISION,
    sum_viirs_ntl_201309 DOUBLE PRECISION,
    sum_viirs_ntl_201310 DOUBLE PRECISION,
    sum_viirs_ntl_201311 DOUBLE PRECISION,
    sum_viirs_ntl_201312 DOUBLE PRECISION,
    sum_viirs_ntl_201501 DOUBLE PRECISION,
    sum_viirs_ntl_201502 DOUBLE PRECISION,
    sum_viirs_ntl_201503 DOUBLE PRECISION,
    sum_viirs_ntl_201504 DOUBLE PRECISION,
    sum_viirs_ntl_201505 DOUBLE PRECISION,
    sum_viirs_ntl_201506 DOUBLE PRECISION,
    sum_viirs_ntl_201507 DOUBLE PRECISION,
    sum_viirs_ntl_201508 DOUBLE PRECISION,
    sum_viirs_ntl_201509 DOUBLE PRECISION,
    sum_viirs_ntl_201510 DOUBLE PRECISION,
    sum_viirs_ntl_201511 DOUBLE PRECISION,
    sum_viirs_ntl_201512 DOUBLE PRECISION,
    sum_viirs_ntl_201601 DOUBLE PRECISION,
    sum_viirs_ntl_201602 DOUBLE PRECISION,
    sum_viirs_ntl_201603 DOUBLE PRECISION,
    sum_viirs_ntl_201604 DOUBLE PRECISION,
    sum_viirs_ntl_201605 DOUBLE PRECISION,
    sum_viirs_ntl_201606 DOUBLE PRECISION,
    sum_viirs_ntl_201607 DOUBLE PRECISION,
    sum_viirs_ntl_201608 DOUBLE PRECISION,
    sum_viirs_ntl_201609 DOUBLE PRECISION,
    sum_viirs_ntl_201610 DOUBLE PRECISION,
    sum_viirs_ntl_201611 DOUBLE PRECISION,
    sum_viirs_ntl_201612 DOUBLE PRECISION,
    sum_viirs_ntl_201701 DOUBLE PRECISION,
    sum_viirs_ntl_201702 DOUBLE PRECISION,
    sum_viirs_ntl_201703 DOUBLE PRECISION,
    sum_viirs_ntl_201704 DOUBLE PRECISION,
    sum_viirs_ntl_201705 DOUBLE PRECISION,
    sum_viirs_ntl_201706 DOUBLE PRECISION,
    sum_viirs_ntl_201707 DOUBLE PRECISION,
    sum_viirs_ntl_201708 DOUBLE PRECISION,
    sum_viirs_ntl_201709 DOUBLE PRECISION,
    sum_viirs_ntl_201710 DOUBLE PRECISION,
    sum_viirs_ntl_201711 DOUBLE PRECISION,
    sum_viirs_ntl_201712 DOUBLE PRECISION,
    sum_viirs_ntl_201801 DOUBLE PRECISION,
    sum_viirs_ntl_201802 DOUBLE PRECISION,
    sum_viirs_ntl_201803 DOUBLE PRECISION,
    sum_viirs_ntl_201804 DOUBLE PRECISION,
    sum_viirs_ntl_201805 DOUBLE PRECISION,
    sum_viirs_ntl_201806 DOUBLE PRECISION,
    sum_viirs_ntl_201807 DOUBLE PRECISION,
    sum_viirs_ntl_201808 DOUBLE PRECISION,
    sum_viirs_ntl_201809 DOUBLE PRECISION,
    sum_viirs_ntl_201810 DOUBLE PRECISION,
    sum_viirs_ntl_201811 DOUBLE PRECISION,
    sum_viirs_ntl_201812 DOUBLE PRECISION,
    sum_viirs_ntl_201901 DOUBLE PRECISION,
    sum_viirs_ntl_201902 DOUBLE PRECISION,
    sum_viirs_ntl_201903 DOUBLE PRECISION,
    sum_viirs_ntl_201904 DOUBLE PRECISION,
    sum_viirs_ntl_201905 DOUBLE PRECISION,
    sum_viirs_ntl_201906 DOUBLE PRECISION,
    sum_viirs_ntl_201907 DOUBLE PRECISION,
    sum_viirs_ntl_201908 DOUBLE PRECISION,
    sum_viirs_ntl_201909 DOUBLE PRECISION,
    sum_viirs_ntl_201910 DOUBLE PRECISION,
    sum_viirs_ntl_201911 DOUBLE PRECISION,
    sum_viirs_ntl_201912 DOUBLE PRECISION,
    sum_viirs_ntl_202001 DOUBLE PRECISION,
    sum_viirs_ntl_202002 DOUBLE PRECISION,
    sum_viirs_ntl_202003 DOUBLE PRECISION,
    sum_viirs_ntl_202004 DOUBLE PRECISION,
    sum_viirs_ntl_202005 DOUBLE PRECISION,
    sum_viirs_ntl_202006 DOUBLE PRECISION,
    sum_viirs_ntl_202007 DOUBLE PRECISION,
    sum_viirs_ntl_202008 DOUBLE PRECISION,
    sum_viirs_ntl_202009 DOUBLE PRECISION,
    sum_viirs_ntl_202010 DOUBLE PRECISION,
    sum_viirs_ntl_202011 DOUBLE PRECISION,
    sum_viirs_ntl_202012 DOUBLE PRECISION,
    sum_viirs_ntl_2012 DOUBLE PRECISION,
    sum_viirs_ntl_2013 DOUBLE PRECISION,
    sum_viirs_ntl_2014 DOUBLE PRECISION,
    sum_viirs_ntl_2015 DOUBLE PRECISION,
    sum_viirs_ntl_2016 DOUBLE PRECISION,
    sum_viirs_ntl_2017 DOUBLE PRECISION,
    sum_viirs_ntl_2018 DOUBLE PRECISION,
    sum_viirs_ntl_2019 DOUBLE PRECISION,
    sum_viirs_ntl_2020 DOUBLE PRECISION,
    sum_viirs_ntl_2021 DOUBLE PRECISION,
    sum_viirs_ntl_2022 DOUBLE PRECISION,
    sum_viirs_ntl_2023 DOUBLE PRECISION,
    sum_viirs_ntl_2024 DOUBLE PRECISION,
    sum_built_area_m_1975 DOUBLE PRECISION,
    sum_built_area_m_1980 DOUBLE PRECISION,
    sum_built_area_m_1985 DOUBLE PRECISION,
    sum_built_area_m_1990 DOUBLE PRECISION,
    sum_built_area_m_1995 DOUBLE PRECISION,
    sum_built_area_m_2000 DOUBLE PRECISION,
    sum_built_area_m_2005 DOUBLE PRECISION,
    sum_built_area_m_2010 DOUBLE PRECISION,
    sum_built_area_m_2015 DOUBLE PRECISION,
    sum_built_area_m_2020 DOUBLE PRECISION,
    sum_built_area_m_2025 DOUBLE PRECISION
);

-- Create climate table
CREATE TABLE IF NOT EXISTS climate (
    hex_id TEXT,
    date DATE,
    spi FLOAT,
    PRIMARY KEY (hex_id, date)
);

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_space2stats_hex_id ON space2stats (hex_id);
CREATE INDEX IF NOT EXISTS idx_climate_hex_id ON climate (hex_id);
CREATE INDEX IF NOT EXISTS idx_climate_date ON climate (date);

-- Enable extensions
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS h3;
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";



